<!doctype>
<html>
<head>
<title>Make meme || Trollme</title>
<meta charset="utf-8" >
<style type="text/css">
#canvas{
 margin-left:30px;
}


#division{
width:380px;
height:250px;
float:right;
margin-top:10px;
margin-right:0px;

}
#uppertext{
height:30px;
}
#bottomtext{
height:30px;
}
#coolor{
height:30px;
}

#sizee{
height:30px;
width:175px;
}

#scale{
height:30px;
width:175px;
}
#rotate{
height:30px;
width:175px;
}


div.scrollmenu {
    
    background-color:#58D68D;// #333;
    overflow: auto;
    white-space: nowrap;
}

#download
{
    background-color: navy;
    color: white;
    font-weight: bold;
    text-decoration: none;
	
}

</style>

</head>
<body>

<div id="container">
<div id="main61">
  <div id="division"></br>
  
</br> </br> </br> </br>
  &nbsp TOP TEXT: &nbsp  &nbsp &nbsp  &nbsp &nbsp <input id="uppertext" type="text"  cols="20" rows="10" placeholder="TOP TEXT" onkeyup="textis()"/>
  </br>
  </br>
  
   &nbsp BOTTOM TEXT:   <input id="bottomtext" type="text" placeholder="BOTTOM TEXT" onkeyup="textis()"/>
  
   </br>
   </br>
    &nbsp TEXT COLOR:   &nbsp  &nbsp <input id="coolor" class="jscolor" value="#128C3B" onchange="textis()">
   
   </br>
   </br>
    &nbsp TEXT SIZE: &nbsp &nbsp &nbsp &nbsp <input type="number"  id="sizee" max="30" min="10"  value="20"  onchange="textis()">
   
   
   </br>
   </br>
   &nbsp ZOOM: &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp <input id="scale" max="3" min="0.5" step="0.01" type="range" value="1" />
  
 
  </br>
  </br>
  &nbsp ROTATE:  &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp <input id="rotate" max="180" min="-180" step="1" type="range" value="0" />
  </br> </br> </br> </br>
 
   </div>
   
   </br> </br>
   
 <canvas id="canvas">
 
 canvas is not supported by your browser
 </canvas>
 </br> 
 &nbsp &nbsp &nbsp <input id="fileInputt" type="file" accept="image/*" value="choose your file" /> &nbsp &nbsp &nbsp   &nbsp &nbsp &nbsp 
<a id="download" download='https://www.facebook.com/Officialtrollme.png'><button type="button" onClick="download()">Download</button></a>

 </br>
 </br> </br>
   
  
   
   <script>


var can=document.getElementById("canvas");
var drawcan= can.getContext("2d");

var img1;
var deviceWidth = window.innerWidth;;

var canvasWidth = Math.min(500, deviceWidth-20);
var canvasHeight = Math.min(480, deviceWidth-20);
 
  canvas.width = canvasWidth;
  canvas.height = canvasHeight;
  var text,text1;
 
  
  
  clearre();

var img ;
   drawcan.fillStyle="#128C3B";
   drawcan.font = "30px Arial";
   drawcan.fillText("UPLOAD YOUR PHOTO",110,220);
     size();
  function function1(img2)
  
{    clearre();

    drawcan.drawImage(img2,0,80,can.width,can.height-160);
	img1=img2;
	
	size();
	dotransform(img1);

}
   function size()
   {
   
   document.getElementById("scale").value = "1";
	document.getElementById("rotate").value = "0";
	document.getElementById("uppertext").value = "";
	document.getElementById("bottomtext").value = "";
	document.getElementById("sizee").value = "20";
	
   }
  var scale = document.getElementById('scale');
    scale.addEventListener('change', doTransform, false);
 
  var  rotate = document.getElementById('rotate');
    rotate.addEventListener('change', doTransform, false);
	
	function doTransform() {
    drawcan.save();
 
    // Clear canvas
    drawcan.clearRect(0,80,can.width,can.height-160);
 
    
    // Translate to center so transformations will apply around this point
    drawcan.translate(canvas.width/2, canvas.height/2);
 
    // Perform scale
    var val = document.getElementById('scale').value;
    drawcan.scale(val, val);
 
    // Perform rotation
    val = document.getElementById('rotate').value;
    drawcan.rotate(val*Math.PI/180);
 
    // Reverse the earlier translation
    drawcan.translate(-canvas.width/2, -canvas.height/2);
 
    // Finally, draw the image
	
	drawcan.drawImage(img1,0,80,can.width,can.height-160);
	
	
	
    drawcan.restore();
	
	clearre();
  
  textis();
 
  }
  
  
  
 function clear()
 {
    drawcan.fillStyle="#ffffff";

   drawcan.fillRect(0,0,can.width,can.height);
 }
 
 //for rectangle clear
 function clearre()
 {
    drawcan.fillStyle="#ffffff";
    drawcan.fillRect(0,0,can.width,80);
    drawcan.fillRect(0,can.height-80,can.width,80);
   
 }
  
  
  
  
  //for upper and lower text
    function textis()
	{
	clearre();
	
    drawcan.lineWidth  = 5;
	var size=document.getElementById('sizee').value;
    drawcan.font = size+'px Sans Serif';
    drawcan.strokeStyle = 'blue';
   var col="#"+document.getElementById('coolor').value;
    drawcan.fillStyle = col;
    drawcan.textAlign = 'center';
    drawcan.lineJoin = 'round';
  
  
  
  var a1,a2,a3,a4,b1,b2,b3,b4;
     var i;
	 
	 
  // Draw the textfor top text
    text = document.getElementById('uppertext').value;
    text = text.toUpperCase();
    x = canvas.width/2;
    y = 40;

  
   for ( i=0;i<36;i++)
   
   {  if(text.charAt(i)==" ")  { a2=i; }if(i<35){ a1=i; } else{ a1=a2;} }
  
for ( i=36;i<72;i++) { if(text.charAt(i)==" ") { b1=i; }if(i<71){ b2=i; }else{b2=b1;}}

   var text0 = text.substring(0,a1);
    var text00 = text.slice(a1, b2);
   for(i=0;i<text.length;i++)
   {
   if(i<36)
   {drawcan.fillText(text0, x, y);}
	else{drawcan.fillText(text00, x, (y+18));}}
	
	
	
	
 // for bottom text
	 text1 = document.getElementById('bottomtext').value;
    text1 = text1.toUpperCase();
    x1 = canvas.width/2;
    y1 = canvas.height - 40;
	
	
	for ( i=0;i<36;i++)
   
   {  if(text1.charAt(i)==" ")  { a4=i; }if(i<35){ a3=i; } else{ a3=a4;} }
  
for ( i=36;i<72;i++) { if(text1.charAt(i)==" ") { b3=i; }if(i<71){ b4=i; }else{b4=b3;}}
	
	
	
 
    
    var text12 = text1.substring(0,a3);
    var text13 = text1.slice(a3, b4);
   for(var i=0;i<text1.length;i++)
   { 
   if(i<36)
   {drawcan.fillText(text12, x1, y1);}
	else{drawcan.fillText(text13, x1, (y1+18));}}
	
	}
	
   function downloadCanvas(link, canvasid, filename) {
    link.href = document.getElementById(canvasid).toDataURL();
    link.download = filename;
}

if(!window.chrome)
{
document.getElementById('download').addEventListener('click', function() {
    downloadCanvas(this, 'canvas', 'trollmelol.png');
}, false);
 
 }
   //for image onclick;
 
	function troll(imgtroll)
	{
         
		 var img1 = document.getElementById(imgtroll);
	     
		 function1(img1);
		 
	}
	
	
	
	// for uploading image 
	
	 var imageLoader = document.getElementById('fileInputt');
    imageLoader.addEventListener('change', handleImage, false);


function handleImage(e){
    var reader = new FileReader();
    reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
           
          clear();
		   function1(img);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);   

	
}





function download(){
		var download = document.getElementById("download");
		var image = document.getElementById("canvas").toDataURL("image/png")
                    .replace("image/png", "image/octet-stream");
			  download.setAttribute("href", image);
			  //download.setAttribute("download","archive.png");
	}




</script>

</div>

</div>
<script id="coloor" src="jscolor.js"></script>
</body>
</html>
